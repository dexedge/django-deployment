{% extends 'schletter_app/base.html' %}
{% load my_tags %}
{% block page_header %}
  <div class="row">
    <h2>Events</h2>
    <span class="pt-2 pl-4"> ({{ paginator.count }})</span>
    <form class="form-inline mb-3 ml-auto" action="." method="get">
      <div class="form-group">
        <select id="theater" name="theater" class="form-control" type="text">
          <option value="">Theater</option>
          <option value="Bth">Bth</option>
          <option value="Kth">Kth</option>
        </select>
      </div>
      <div class="form-group ml-2">        
        <select id="company" name="company" class="form-control" type="text">
          <option value="">Company</option>
          {% for company in companies %}
            <option value="{{company}}">{{company}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group ml-2">        
        <select id="event_type" name="event_type" class="form-control" type="text">
          <option value="">Type</option>
          {% for event_type in event_types %}
            <option value="{{event_type}}">{{event_type}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group ml-2">        
        <select id="genre" name="genre" class="form-control" type="text">
          <option value="">Genre</option>
          {% for genre in genres %}
            <option value="{{genre}}">{{genre}}</option>
          {% endfor %}
        </select>
      </div>
      <button class="btn btn-primary ml-2" type="submit">Search</button>
      <a class="btn btn-secondary ml-2" href="{% url 'schletter_app:events' %}" role="button">Reset</a>
    </form>
  </div>
{% endblock %}

{% block content %}
  <table class="table table-striped">
    <thead class="thead-light">
      <tr>
        <th class="text-right" style="width: 20%">Date</th>
        <th style="width: 6%">Theater</th>
        <th style="width: 6%">Company</th>
        <th style="width: 6%">Type</th>
        <th style="width: 22%">Genre</th>
        <th style="width: 40%">Title</th>
      </tr>
    </thead>
    {% for event in events %}
      <tr>
        <td class="text-right">
          <a href="{% url 'schletter_app:event' event.pk %}">{{ event.date }}</a>
        </td>
        <td>{{ event.theater }}</td>
        <td>{{ event.company }}</td>
        <td>{{ event.event_type }}</td>
        <td>{{ event.work_set.all.first.genre }}</td>
        {% with event.work_set.all.first as work %}
          {% if not work or event.event_type == "closed" %}
            <td>{{event.title}}</td>
          {% else %}
            <td><a href="{% url 'schletter_app:work' work.pk %}">{{ event.title | display_title:work.genre | safe }}</a></td>
          {% endif %}
        {% endwith %}
      </tr>
    {% empty%}
      <p>No events match this search</p>
    {% endfor %}
  </table>
{% endblock content %}


